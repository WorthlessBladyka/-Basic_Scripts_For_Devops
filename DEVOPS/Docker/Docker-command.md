# Docker RUN

**$ docker run <образ>** -  запуск контейнера из образа
	$ docker run -it alpine sh - в контейнере подключилась оболочка shell и с помощью параметра -it мы подключились к ней
##### Tag

$ docker run redis:6.0.9 - указывается tag после ":"

##### STDIN

$ docker run -it rotorocloud/prompt-docker - параметр "t" подключает наш терминал, параметр "i" подключает интерактивную среду

! Из коробки у docker нет поддуржки интераетивной среды, для ее подключения и используются эти две команды

$ echo "Vlad" | docker run -i rotorocloud/prompt-docker - запускает docker container с нашим терминалом и передают во внутрь с помощью команды echo строку "Vlad"

##### Port mapping

хост:контейнер

$ docker run -p 80:5000 rotorocloud/webaap - опубликовать порты docker на host. Сопоставляет порты docker-container и docker-host. Необходимо, для подключения пользователей из вне. То есть, весь трафик полученный из вне будет приходить на порт 80, а затем маршрутизироваться на порт 5000, уже в контейнер. 
	Ограничение в том, что нельзя поставить порт docker-host несколько раз.

##### Volume mapping

! При создании контейнера, все постоянные данные будут сохраняться в /var/lib/mysql.
! Контейнер имеет свою изолированную файловую систему, и не имеет ничего обшего с ФС host-а.
! При удалении контейнера, будут удалены все данные

Как хранить постоянные данные? Подключить их из вне!
$ docker run -v <от:куда> <name_> - с помощью параметра -v  указываем через : где мы будем хранить данные из вне, а затем путь хранилище контейнера.
$ docker run -v /opt/datadir/:/var/lib/mysql mysql - пример

##### Additional Into

docker inspect <name/ID container> - возращает json файл с информацией об контейнере

##### App Status - "проблишутинг"

! Запустить контейнер в фоновом режиме
$ docker logs - выводит логи в окне терминала

##### -e "Установка переменных окружения внутри контейнера"

```
$ docker run -e DATABASE_HOST=localhost myapp
```

#### Docker RUN особенности

##### Attach or detach

! Приложение может быть развернуто в фоне или в моей консоле.

$ docker run rotorocloud/webapp - развернуть контейнер в моей консоли. Работа с консолью не доступна. Attach mod.

$ docker run -d rotorocloud/webapp - развернуть контейнер в консоли. Работа с консолью **доступна**.

$ docker attach <ID/NAME container> - перевести консоль в attach mod.
##### run and other

$ docker run <name_images> cat /etc/*realease* - запустить контейнер и вывести информацию о ядре

# Docker exec - выполнение команд внутри запущенного контейнера.

```
docker exec [ОПЦИИ] КОНТЕЙНЕР КОМАНДА [АРГУМЕНТЫ...]
```

| Опция           | Сокращение | Назначение                                     |
| --------------- | ---------- | ---------------------------------------------- |
| `--interactive` | `-i`       | Интерактивный режим (сохраняет STDIN открытым) |
| `--tty`         | `-t`       | Псевдо-TTY (терминал)                          |
| `--detach`      | `-d`       | Запуск в фоновом режиме                        |
| `--user`        | `-u`       | Указание пользователя                          |
| `--workdir`     | `-w`       | Установка рабочей директории                   |
| `--env`         | `-e`       | Установка переменных окружения                 |
| `--privileged`  |            | Расширенные привилегии                         |
##### Пример:
```
docker exec -it mysql-container mysql -u root -p
		# Подключиться к контейнеру MySQL
```

- Интерактивный shell в контейнере:
```
docker exec -it my-container bash
docker exec -it my-container sh
```

- Выполнение одной команды:
```
docker exec my-container ls -la
docker exec my-container cat /etc/hosts
```

- Выполнение команды с конкретным пользователем:
```
docker exec -u postgres postgres-container psql
docker exec -u 1000 my-container whoami
```

- Передача переменных окружения:
```
docker exec -e DEBUG=true my-container env
```
##### Временный характер:
- Изменения внутри `docker exec` не сохраняются в образ
- Файлы, созданные во время выполнения, существуют только в running контейнере
# Общее

### Cеть -H host
```
$ docker -H=remote-docker-engine:2375
			#подключаться к удаленному Docker Engine вместо локального
$ docker -H=10.40.1.2:2375 run nginx
			#запускает контейнер nginx на удаленном Docker Engine
```
### Cgroups ограничить использование ресурсов
``` 
$ docker run --cpus=.5 nginx
			#ограничить ресурсы cpu для работы контейнера до 50%
```
```
$ docker run --memory=100m nginx
			#ограничить ресурсы RAM для работы контейнера до 100 мб
```
###  File_system
```
! /var/lib/docker
	overlay2
	containers
	images
	volumes - тома
```

``` docker_voluming
$ docker volume create data_volume
			#создать том в /volumes
$ docker run -v data_volume:/var/lib/mysql mysql
			# подключить том к docker_counter mysql
```
```

```

``` bind_mounting
$ docker run -v /data/mysql:/var/lib/mysql
			 # способ монтирования с указанием полного пути
```

``` style
-v - старый стиль монтирования

--mount
  $ docker run --mount type=build,source=/data/mysql,target=/var/lib/mysql mysql
```
###
docker ps - посмотреть список запущенных контейнеров и общую информацию о них
docker ps -a - посмотреть список всех контейнеров и общую информацию о них

docker stop <имя контейнера/ID контейнера> - остановить работу контейнера

**docker rm <имя контейнера/ID контейнера>** - удаляет завершенный или остановленный контейнер
	**docker rm $(docker ps -aq)** - удалить все остановленные контейнеры

docker images - выводит информацию об образах на локальном диске

docker rmi <имя образа> - удалить образ с локального диска. (! Перед удалением удостовериться, что на машине нет запущенных контейнеров содержащих удаляемый образ
	docker rmi $(docker images --all) - удалить все образы

docker pull <имя образа> - скачать образ не запуская его в контейнере

docker exec <параметры> <имя_контейнера> <команда> - запускает новую команду в работающем контейнере.
	docker exec my_container cat /etc/hosts - пример команды, открывает файл hosts

docker start <name/ID container> - запустить остановленный контейнер

**docker version** - узнать версию docker

# Управление ресурсами
 
# Особенности контейнеров

! Контейнеры не предназначены для запуска операционных систем. Контейнеры предназначены для запуска->выполнения задачи->завершения. (При запуске контейнера с образом ubuntu, машина запустится и завершит работу. Образ ubuntu служит площадкой размещения образов для выполнения задач)

$ docker run ubuntu sleep -5 - команда, которая поможет продемонстрировать работу контейнера с образом ubuntu.

! При работу, к примеру, веб-сервера в docker контейнере и при его краше или завершения работы, docker контейнер также завершит свою работу в обоих случаях)





