==Docker-образы== — это неизменяемые шаблоны только для чтения, из которых создаются контейнеры, содержащие все необходимое для запуска приложения: код, среду выполнения, библиотеки и конфигурационные файлы.

![[photo_5413387672371725422_w.jpg]]
## command "Docker build"

$ docker build . -t PATH | URL - команда используется для создания образа Docker из Dockerfile и «контекста».
PATH AND URL
- `PATH`: Как правило, это локальный каталог, содержащий `Dockerfile`и другие файлы, необходимые для сборки. Обычно используется `.` для указания текущего рабочего каталога.
- `URL`: Например, URL-адрес, указывающий на репозиторий Git, также может использоваться в качестве контекста сборки.
OPTIONS
- `-t`или `--tag <name>:<tag>`: присваивает имя и необязательный тег полученному images. Например,`docker build -t myapp:latest .`
- `--no-cache`: Принудительно перестраивает все слои без использования кэшированных слоев из предыдущих сборок, обеспечивая чистую сборку.
- `--build-arg <name>=<value>`: Устанавливает переменные времени сборки, которые можно использовать внутри `Dockerfile`.
- `-f`или `--file <path/to/Dockerfile>`: указывает альтернативный путь к Dockerfile, если он не назван `Dockerfile`или не находится в корне контекста сборки.
-  . билдить отсюда
! Во время сборки образа эта команда выводит все шаги, которые она выполняет и их результат

## command docker push

$ docker push rotorocloud/webapp - залить image на docker hub
	rotorocloud - имя аккаунта на docker hub
	webapp - имя images

## command docker tag

$ docker tag <ID_container> <name:tag> - задать name и tag созданному image 

## Docker push

$ docker login - команда создаст локальные данные с логином в домашней папке

$ docker push <name_dockerHub>/<name_images:tag>
## Variable Environmental

! Для просмотра какие переменные окружения используются в контейнере docker введи команду на запущенном контейнере:
$ docker inspect <name_container>
! Нужная информация будет в строке "Env".
### Назначение переменной среды в dockerFile

dockerfile:
	rocket = os.environ.het('ROCKET_SIZE')
linux:
	export ROCKET_SIZE=big; python3 app.py
run:
	docker run -e ROCKET_SIZE=big <name_dockerHub>/<name_images:tag>

## DockerFile

![[photo_5413387672371725423_w.jpg]]
## Инструкции DockerFile
| Инструкция      | Назначение           | Описание                                                                                                            |
| --------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------- |
| **FROM**        | Базовый образ        | Указывает базовый образ для сборки                                                                                  |
| **RUN**         | Выполнение команд    | Выполняет команды в контейнере during сборки                                                                        |
| **CMD**         | Команда по умолчанию | Определяет команду по умолчанию при запуске контейнера                                                              |
| **LABEL**       | Метаданные           | Добавляет метаданные к образу                                                                                       |
| **EXPOSE**      | Порт                 | Указывает порты для прослушивания                                                                                   |
| **ENV**         | Переменные окружения | Устанавливает переменные окружения                                                                                  |
| **ADD**         | Копирование файлов   | Копирует файлы/папки/URL в образ                                                                                    |
| **COPY**        | Копирование файлов   | Копирует файлы и папки в образ                                                                                      |
| **ENTRYPOINT**  | Точка входа          | В команде указывается как будет настроен контейнер при запуске (указание постоянного диска, переопределение портов) |
| **VOLUME**      | Тома                 | Создает точку монтирования тома                                                                                     |
| **USER**        | Пользователь         | Устанавливает пользователя для команд                                                                               |
| **WORKDIR**     | Рабочая директория   | Устанавливает рабочую директорию                                                                                    |
| **ARG**         | Аргументы сборки     | Определяет переменные для передачи при сборке                                                                       |
| **ONBUILD**     | Отложенные команды   | Добавляет триггеры для последующих сборок                                                                           |
| **STOPSIGNAL**  | Сигнал остановки     | Сигнал для остановки контейнера                                                                                     |
| **HEALTHCHECK** | Проверка здоровья    | Настраивает проверку здоровья контейнера                                                                            |
| **SHELL**       | Используемый shell   | Определяет используемый shell по умолчанию                                                                          |
```
FROM Ubuntu
CMD sleep 5         #format bash/shell

или
CMD ["sleep","5"].  #format JSON array
```
#### Инструкции ADD and COPY
- Использовать COPY когда:
	- ✅ Копируете локальные файлы/директории
	- ✅ Нужна предсказуемость поведения
	- ✅ Хотите эффективное кэширование сборки
	- ✅ В 95% случаев использования
- Использовать ADD когда:
	- ✅ Нужно распаковать локальный архив
	- ✅ Нужно скачать файл по URL
	- ✅ Специфические случаи с авто-распаковкой
### Инструкции CMD and ENTRYPOINT

```
FROM ubuntu
ENTRYPOINT ["sleep"]
			#указываем инструкцию при запуске по умол.
CMD ["5"]
			#указываем атрибут по умол. для инструкции sleep

$ docker run ubuntuImage 10
			#переопределяем атрибут в CMD для инструкции в ENTRYPOINT
```
!Чтобы это сработало, нудно указывать инструкции и атрибуты в формате JSON

Чтобы переопределить ENTRYPOINT на работающем контейнере, нужно:
```
$ docker run --entrypoint super-sleep ubuntu-server 10
```
## Layer and layer error

![[photo_5413387672371725425_w.jpg]]

$ docker history rotorocloud/webapp - вывести информацию images

![[photo_5413387672371725421_w.jpg]]

! Все слои при их использовании подгружаются в кэш
! Если в одном из слоев произошел сбой, то при пересборки решения, все успешно забилженные слои до сбоя будут подгруженны из кэша.
! Если при пересборки решения в слое были изменения в коде, то слой будет перекомпилирован

## Что контенеризируется?

![[photo_5413387672371725419_w.jpg]]


